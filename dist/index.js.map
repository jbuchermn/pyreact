{"version":3,"file":"index.js","sources":["../src/PyreactRoot.js"],"sourcesContent":["import React from 'react'\n\nconst connect = (port, onMessage, initialMsg) => {\n    let socket = new WebSocket(\"ws://\" + location.hostname + \":\" + port);\n\n    socket.onopen = (_) => {\n        console.log(\"[ws:open] Connection established\");\n        socket.send(JSON.stringify(initialMsg));\n    };\n\n    socket.onmessage = (event) => {\n        console.log(`[ws:message] Data received from server: ${event.data}`);\n        onMessage(JSON.parse(event.data), (msg) => socket.send(JSON.stringify(msg)));\n    };\n\n    socket.onclose = (_) => {\n        console.log('[ws:close] Connection closed... reconnecting...');\n        setTimeout(() => connect(port, onMessage, initialMsg), 200);\n    };\n\n    socket.onerror = (error) => {\n        console.log(`[ws:error] ${error.message}`);\n    };\n}\n\nconst unwrap = (props, send) => {\n    if (props === undefined || props === null){\n        return props;\n    }else if (Array.isArray(props)) {\n        return props.map(p => unwrap(p));\n    } else if (typeof props === \"object\") {\n        let res = {};\n        Object.keys(props).forEach(k => res[k] = unwrap(props[k], send));\n        return res;\n    } else {\n        if (typeof props === \"string\" && props.includes(\"__pyreact_pyfunc\")) {\n            return ((...args) => send({\n                '__pyreact_kind': 'func_call',\n                '__pyreact_id': props,\n                '__pyreact_args': args,\n            }));\n        }\n        return props;\n    }\n}\n\nexport default class PyreactRoot extends React.Component {\n    constructor(props) {\n        super(props);\n        this.state = { props: {} };\n    }\n\n    componentDidMount(){\n        connect(this.props.port || 8081, (msg, send) => {\n            let props = unwrap(msg.props, send);\n            console.log(\"[pyreact-root]\", props)\n            this.setState({props});\n\n        }, {'__pyreact_kind': 'request_render'});\n    }\n\n    render() {\n        return this.props.children(this.state.props);\n    }\n}\n"],"names":["connect","port","onMessage","initialMsg","socket","WebSocket","location","hostname","onopen","_","console","log","send","JSON","stringify","onmessage","event","data","parse","msg","onclose","setTimeout","onerror","error","message","unwrap","props","undefined","Array","isArray","map","p","res","Object","keys","forEach","k","includes","args","PyreactRoot","state","componentDidMount","setState","render","children","React","Component"],"mappings":"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"}